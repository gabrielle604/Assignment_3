---
title: "Assignment 3"
author: "Gabrielle"
date: '2022-11-09'
output: 
  html_document:
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,message=FALSE,warning = FALSE,results=FALSE)

library(tidyverse)
library(here)
library(ggpubr) # for some graphic applications that extend ggplot2
library(janitor)
# install.packages("lsr")
library(lsr)
library(effsize)
library(dplyr)
# install.packages("qqplotr")
library(qqplotr)
library(ggplot2)
# install.packages("DescTools")
library(DescTools)

```

## 1
In order to determine if the current population in the San Antonio River in Santa Barbara County is different from the historical record, I did a one sample t-test, and set mu to equal 4.2 cm (rather than the default, mu = 0), the value from 1955 document that reported the population mean length of adult tidewater gobies. I did this because I am testing to see if there is a statistical difference between the historical mean length of gobies, and the current mean length of gobies (3.5 cm). The one-sample t-test allows us to compare the mean from sample data to a value, usually testing literature point estimates. This test does assume equal variance. 
I found a statistical difference between the current San Antonio Goby fish mean length, and the historical 1955 Goby population mean length (t(9 df), p = 0.0008873), ⍺ = 0.05.
CI: 3.189284, 3.830716

```{r, message=FALSE}
# San Antonio River gobies in centimeters  
# data input: creating a vector of data
san_ant_gobies <- c(2.7, 3.2, 3.2, 3.3, 3.5, 3.6, 3.6, 3.7, 4.0, 4.3)

summary(san_ant_gobies)

san_ant_gobies_one_t <- t.test(san_ant_gobies, mu=4.2)
san_ant_gobies_one_t
```


## 2
Are the tidewater goby lengths in question 1 normally distributed? Provide a figure with caption **or** critical statistical test and justify your results and conclusion.

For this data, to look at whether the tidewater goby lengths are normally distributed, we're going to look at a qq plot. It should be mostly a straight line, however, due to there being very few observations (n=10),  some wobble to the line is expected. 

To determine whether the tidewater goby lengths in question 1 are normally distributed, I carried out a Shapiro-Wilks normaltiy test. W = 0.97657, p = 0.9442. Since this value from the Shapiro Wilk's test is not less than .05, I can assume the sample data comes from a population that is normally distributed.

```{r}
shapiro.test(san_ant_gobies)
```


```{r goby_1, fig.align='center',fig.cap="Figure 1. Quantile-Quantile plot showing the empirically observed quantiles of San Antonio River Gobies (cm) as a function of quantiles expected from a normal distribution with the same mean and variance as the empirical distribution."}
# qqplot for san antonio river gobies
goby_df<-data.frame(data=san_ant_gobies)

qqplot_san_ant_gobies <- ggplot(data=goby_df, aes(sample = data)) + 
                         geom_qq() + 
                         stat_qq_line() +
                         theme_minimal() +
                         labs(title = "San Antonio River Gobies") +
qqplot_san_ant_gobies
```


## Question 3:
The UC Tobacco Free Campus Initiative wants to know if the UC reserves have more or less cigarette butt load as urban open spaces. 
Use your knowledge of statistics to:
1. justify the appropriate statistical test to use
2. explain the results and conclusion of the test you selected
3. make a figure with caption to best explain the data and results.

The non-parametric, Mann-Whitney U test (called Wilcox test in R) is the appropriate statistical test becuase the data is not normal; it is skewed. The Wilcox test in R is the pairwise comparison analogous to the Tukey HSD by looking at pairwise Wilcox tests that have been adjusted for multiple comparison, a type of continuity correction. Here we have used the easiest correction, Bonferroni, where the p-value from the pairwise test is multiplied by the number of comparisons.

Since non-parametric evaluations are largely based on comparing medians instead of means, it is suggested that you plot the results using box plots instead of means and 95% confidence intervals as done parametrically. 

```{r}
uc_reserves <- data.frame(cig_butts=c(4, 1, 8, 0, 0, 0, 0, 23, 28, 0, 0, 0, 4, 0, 3, 0, 0, 2, 0, 5, 0, 0, 0, 0, 0),location="Reserve")


urban_open <- data.frame(cig_butts=c(33, 9, 9, 7, 2, 38, 9, 20, 0, 39, 18, 41, 25, 164, 37, 60, 55, 45, 14, 3, 69, 60, 13, 1), location="Urban Open Space")

cig_df <- rbind(uc_reserves, urban_open)

qqplot_uc_reserves <- ggplot((uc_reserves), aes(sample = cig_butts)) +
  geom_qq() +
  labs(title = "UC Reserves") +
  theme_minimal()

qqplot_uc_reserves

qqplot_urban_open <- ggplot((urban_open), aes(sample = cig_butts)) +
  geom_qq() +
  labs(title = "Urban Open Space") +
  theme_minimal()

qqplot_urban_open

# showing the skewed data

```

```{r}
pairwise.wilcox.test(cig_df$cig_butts, cig_df$location, p.adjust.method = "bonferroni")

wilcox.test(uc_reserves$cig_butts, urban_open$cig_butts, paired = FALSE)
```
The bonferroni adjustment takes the p value divided by the number of groups (for this, divide by two, due to UC Reserves and Urban Open Space)

Mann Whitney U is an unpaired test of medians, whereas Wilcoxon is paired tests of medians between two groups. Default, paired = FALSE, comparing independent unpaired samples together. 

```{r cig_load_1, fig.align='center',fig.cap="Figure 2. Boxplot showing cigarette butt load for the UC Reserve and for Urban Open Space, the boxes marking quantile 1, the median, quantile 3, and the dots denote the outliers."}
boxplot_cig_load <- ggplot(data = cig_df, aes(x = location, y = cig_butts)) +
  geom_boxplot() +
  theme_minimal() +
  labs(title = "Cigarette Butt Load", x = "Location", y = "Cigarette Butts")

boxplot_cig_load
```





## Question 4:
Is there evidence that this new species of turtles' time between laid egg and hatching is temperature dependent? 

1. justify the appropriate statistical tests to use
2. explain the results and conclusion of the test you selected
3. make a figure with a caption to best explain the data, results, and conclusion


Four groups: 15C, 20C, 25C, 30C

how did you look at the data?
what did you find?
provide a nice figure?


* not a reflection of temperature but rather of "treatment" (treatment 1, 2, 3, 4)
* if you move away from two groups, then do ANOVA
* check assumptions of ANOVA and determine whether to do ANOVA or non-parametric 
* no data is perfect



Load in the data:
```{r}
turtles <- read_csv(here("data", "Turtles.csv"))

turtles_scatter <- ggplot(turtles, aes(x = Temperature, y = Days)) +
  geom_point() +
  labs(title = "Relationship between temperature and number of days to turtle egg hatching", x = "Temperature (C)", y = "Days") +
  geom_smooth(formula = y~x, method = lm) +
  theme_minimal()

turtles_scatter

# you have a discrete treatment (forced temp (which is typically continuous) into being discrete)

# separate out 15C, 20C, 25C, 30C
# do summary statistics for each of these - do you expect to see a difference? YES
turtles_15c <- turtles %>% filter(Temperature == "15")
summary(turtles_15c)

turtles_20c <- turtles %>% filter(Temperature == "20")
summary(turtles_20c)

turtles_25c <- turtles %>% filter(Temperature == "25")
summary(turtles_25c)

turtles_30c <- turtles %>% filter(Temperature == "30")
summary(turtles_30c)

```

```{r}
# test for normality using qq plot and shapiros test for each 
# look at variances - is it wonkey? is it normal? *credibility if they are the same
# TYPE 1 error ... four groups... what does a p value mean in light of running a bunch of tests!
# three are normal and one is not *totally fine - you never have data that is perfect


qqplot_15c <- ggplot(turtles_15c, 
                     aes(sample = Days)) +
                     geom_qq() +
                     labs(title = "Turtles at 15C") +
                     theme_minimal()
qqplot_15c

shapiro.test(turtles_15c$Days)

qqplot_20c <- ggplot(turtles_20c, 
                     aes(sample = Days)) +
                     geom_qq() +
                     labs(title = "Turtles at 20C") +
                     theme_minimal()
qqplot_20c

shapiro.test(turtles_20c$Days)

qqplot_25c <- ggplot(turtles_25c, 
                     aes(sample = Days)) +
                     geom_qq() +
                     labs(title = "Turtles at 25C") +
                     theme_minimal()
qqplot_25c

shapiro.test(turtles_25c$Days)

qqplot_30c <- ggplot(turtles_30c, 
                     aes(sample = Days)) +
                     geom_qq() +
                     labs(title = "Turtles at 30C") +
                     theme_minimal()
qqplot_30c

shapiro.test(turtles_30c$Days)


```

Since these values from the Shapiro Wilk's tests are not less than .05, we can assume the sample data comes from a population that is normally distributed.

Tukey's test: tukey accounts for doing a bunch of comparisons between groups, and deflates the p value to minimize risk of type one error.

```{r}
m_turtles_results <- aov(Days ~ as.factor(Temperature), data = turtles)

m_turtles_results

TukeyHSD(m_turtles_results)

# suppress plots or comment out
plot(m_turtles_results)

# write about the confirmation of the anova assumptions
```
^^^ do these not make sense?
We are able to look at the residual plots using the plot() command. Showing residual vs. fitted shows the distribution of turtle egg incubation time in days. These are the diagnostics. 

RESIDUAL PLOT: the red line is showing you the trend in the data 
Q-Q PLOT: taking the residuals and giving you a Q-Q plot right away for inspection
SCALE LOCATION: (not used much)… it flags heteroskedasticity; some outliers are a bit farther away… you want to see a flat line
Cook’s distance: A measure of how much influence a single observation has on your model; could consider removing a data point to see if it improves the cook’s distance BECAUSE you think it is an outlier
cooks distance of 2 isn’t terrible, but 4, 5, and up are not good


```{r turtles_1, fig.align='center',fig.cap="Figure 4. Plot showing data. Displayed are the means of each incubation temperature with the 95% confidence intervals."}

ggline(turtles, x = "Temperature", y = "Days", 
       main = "Means days of incubation for turtle eggs in each temperature and 95% CI", 
       add = c("mean_ci"), 
       color = "dark gray", 
       ylab = "Days", 
       xlab = "Temperature", 
       point.color = "black")
```
